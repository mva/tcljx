;; Copyright (c) Michael van Acken. All rights reserved.
;; The use and distribution terms for this software are covered by the
;; Eclipse Public License 2.0 (https:;;www.eclipse.org/legal/epl-v20.html)
;; which can be found in the file epl-v20.html at the root of this distribution.
;; By using this software in any fashion, you are agreeing to be bound by
;; the terms of this license.
;; You must not remove this notice, or any other, from this software.
(ns tcljx.run-tests
  (:require
   (tcljx.alpha textflow__pp-test ptest__align-test ptest-test)
   (tcljx.parser reader-test namespace-test error-test redirection-test)
   (tcljx.classgen bootstrap-test invoke-test unreachable-test
                   const-test conv-test prim-conv-test dot-form-test new-test
                   arith-test let-test quote-test meta-test str-test bits-test
                   array-test clone-test switch-test cond-test logic-test
                   xcmp-test try-test loop-test unboxing-test boxing-test)
   
   (tcljx #_fn-member-test

          #_namespace-test #_fn-test #_itf-fn-test #_variadic-test #_macro-test
          #_deftype-test #_record-test #_set-test #_definterface-test #_closure-test
          #_line-test #_letfn-test #_reify-test #_require-test #_main-test

          #_rtiow-nocore-test)
   
   tcljx.main                      ;at least compile unused namespaces
   
   [tcljx.alpha.ptest :refer [run-scoped-tests]]))

(def all-namespaces
  '[tcljx.alpha.ptest-test
    tcljx.alpha.textflow__pp-test
    tcljx.alpha.ptest__align-test
    
    tcljx.parser.reader-test
    tcljx.parser.namespace-test
    tcljx.parser.error-test
    tcljx.parser.redirection-test
    
    tcljx.classgen.bootstrap-test
    tcljx.classgen.invoke-test
    tcljx.classgen.unreachable-test
    tcljx.classgen.const-test
    tcljx.classgen.conv-test
    tcljx.classgen.prim-conv-test
    tcljx.classgen.dot-form-test
    tcljx.classgen.new-test
    tcljx.classgen.arith-test
    tcljx.classgen.let-test
    tcljx.classgen.quote-test
    tcljx.classgen.meta-test
    tcljx.classgen.str-test
    tcljx.classgen.bits-test
    tcljx.classgen.array-test
    tcljx.classgen.clone-test
    tcljx.classgen.switch-test
    tcljx.classgen.cond-test
    tcljx.classgen.logic-test
    tcljx.classgen.xcmp-test
    tcljx.classgen.try-test
    tcljx.classgen.loop-test
    tcljx.classgen.unboxing-test
    tcljx.classgen.boxing-test
    
    #_tcljx.classgen.fn-member-test

    #_tcljx.classgen.namespace-test
    #_tcljx.classgen.fn-test
    #_tcljx.classgen.itf-fn-test
    #_tcljx.classgen.variadic-test
    #_tcljx.classgen.macro-test
    #_tcljx.classgen.deftype-test
    #_tcljx.classgen.record-test
    #_tcljx.classgen.set-test
    #_tcljx.classgen.definterface-test
    #_tcljx.classgen.closure-test
    #_tcljx.classgen.line-test
    #_tcljx.classgen.letfn-test
    #_tcljx.classgen.reify-test
    #_tcljx.classgen.require-test
    #_tcljx.main-test]

  #_tcljx.rtiow-nocore-test)

(defn run []
  (run-scoped-tests all-namespaces))

(defn -main [& args]
  (try
    (apply run args)
    (finally
      (shutdown-agents))))     ;can only shut down when owning the JVM
