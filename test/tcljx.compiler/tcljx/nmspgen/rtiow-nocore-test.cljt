;; Copyright (c) Michael van Acken. All rights reserved.
;; The use and distribution terms for this software are covered by the
;; Eclipse Public License 2.0 (https:;;www.eclipse.org/legal/epl-v20.html)
;; which can be found in the file epl-v20.html at the root of this distribution.
;; By using this software in any fashion, you are agreeing to be bound by
;; the terms of this license.
;; You must not remove this notice, or any other, from this software.
(ns tcljx.nmspgen.rtiow-nocore-test
  (:require
   (tcljx.data [config :as cfg] [files :as files])
   (tcljx.parser [reader :as reader])
   (tcljx.nmspgen [runtime :as rt] [destdir :as destdir]
                  [pkggen :as pkggen] [bootstrap :as bootstrap])
   [tcljx.alpha.ptest :refer [deftest]]))

(deftest compile-rtiow-nocore-test
  (let [ns-str "tcljx.nmspgen.rtiow-nocore-ref"
        ns-path (files/namespace-path ns-str)
        ns-reader (-> (files/path-of "test/tcljx.compiler")
                      (.resolve ns-path)
                      (files/path-url)
                      (slurp)
                      (reader/mk-reader))
        dest-dir (bootstrap/dest-dir-for-this-test)
        app-ld bootstrap/app-ld
        dyn-ld (rt/dyn-class-loader app-ld [])
        rt (rt/mk-runtime app-ld dyn-ld)
        ns-strs (doto (new String/1 1) (aset 0 ns-str))]
    (-> (bootstrap/mk-universe {ns-str ns-reader} rt destdir/dest-none)
        (.require-namespaces* ns-strs nil))))
