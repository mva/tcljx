;; Copyright (c) Michael van Acken. All rights reserved.
;; The use and distribution terms for this software are covered by the
;; Eclipse Public License 2.0 (https:;;www.eclipse.org/legal/epl-v20.html)
;; which can be found in the file epl-v20.html at the root of this distribution.
;; By using this software in any fashion, you are agreeing to be bound by
;; the terms of this license.
;; You must not remove this notice, or any other, from this software.
(ns tcljx.classgen.clone-test
  (:require [tcljx.classgen.bootstrap :refer [asm-expr]]
            [tcljx.alpha.ptest :refer :all]))

(deftest clone-ints-test
  (is (= '[["LOCAL 0: int[] x"]
           (ALOAD_0)
           (INVOKEVIRTUAL "int[]" "clone" "()Ljava/lang/Object;")
           (CHECKCAST "int[]")
           (ARETURN)]
         (asm-expr [^int/1 x] (aclone x)))))

(deftest clone-strings-test
  (is (= '[["LOCAL 0: String[] x"]
           (ALOAD_0)
           (INVOKEVIRTUAL "String[]" "clone" "()Ljava/lang/Object;")
           (CHECKCAST "String[]")
           (ARETURN)]
         (asm-expr [^String/1 x] (aclone x)))))

(deftest clone-multi-test
  (is (= '[["LOCAL 0: int[][] x"]
           (ALOAD_0)
           (INVOKEVIRTUAL "int[][]" "clone" "()Ljava/lang/Object;")
           (CHECKCAST "int[][]")
           (ARETURN)]
         (asm-expr [^int/2 x] (aclone x)))))

(deftest clone-then-toString-test
  (is (= '[["LOCAL 0: int[] x"]
           (ALOAD_0)
           (INVOKEVIRTUAL "int[]" "clone" "()Ljava/lang/Object;")
           (CHECKCAST "int[]")
           (INVOKEVIRTUAL Object "toString" "()Ljava/lang/String;")
           (ARETURN)]
         (asm-expr [^int/1 x] (.toString (aclone x))))))
